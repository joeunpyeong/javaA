package pack01_new;

import java.util.Scanner;

public class Store {
	Scanner sc = new Scanner(System.in);
	Item[] menu;
	int[] sellMenu=new int[8];
	int random,sales=0,selectNum;
	Item[] inven= new Item[6];
	
	// 1. 생성자. 메뉴를 생성한다.
	public Store() {
		menu = new Item[5];//이름, 정보,가격,수량, 힘, 민첩, 지능, 화법, 외모, 체력
		menu[0] = new Item("딸기우유", 1000, 10, 0,0,0,0,0,0,"반도의 흔한 딸기우유");
		menu[1] = new Item("샌드위치", 2000,  5, 0,0,0,0,0,0,"반도의 흔한 샌드위치");
		menu[2] = new Item("메로나",    800, 20, 0,0,0,0,0,0,"반도의 흔한 메로나");
		menu[3] = new Item("풍선껌",    100,  2, 0,0,0,0,0,0,"반도의 흔한 풍선껌");
		menu[4] = new Item("크림빵",   1000,  5, 0,0,0,0,0,0,"반도의 흔한 크림빵");
	}
	
	// 2. 메뉴를 출력하는 메소드.
	public void mixMenu() {
		for (int i = 0; i < sellMenu.length; i++) {
			int random=(int) ((Math.random() * menu.length));
			sellMenu[i]=random;
		}
	}
	
	public void showMenu() {
		System.out.println("----------------------------------------");
		for (int i = 0; i < sellMenu.length; i++) {
			System.out.println((i+1) + ". " + menu[sellMenu[i]].name + " : " + menu[sellMenu[i]].price);
		}
		System.out.println("----------------------------------------");
	}
	
	//인벤토리 장비 정보 보기
	public String menuInfo() {
		System.out.print("\n정보를 보고 싶은 메뉴 번호를 입력해주세요.\n(-1 입력 시 정보 보기 종료)\n=>");
		try {
			selectNum = Integer.parseInt(sc.nextLine());
			if (selectNum == -1) {
				return "";
			} else if (selectNum >= 1 && selectNum <= sellMenu.length) {
				return "아이템: "+menu[sellMenu[selectNum-1]].name+"\n설명:"+menu[sellMenu[selectNum-1]].info+"\n";
			} else {
				System.out.println("메뉴 버튼의 숫자만 입력해주세요.");

			}
		} catch (Exception e) {
			System.out.println("메뉴 버튼의 숫자만 입력해주세요.");
		}
		return "";
	}
	
	// 3.사고 싶은 메뉴를 선택하는 메소드.	
	public int buySelect() {
		while (true) {
			System.out.print("\n구매하고 싶은 메뉴 번호를 입력해주세요.(소지 금액:"+UserStats.money+")\n(-1종료)\n=>");
			try {
				selectNum = Integer.parseInt(sc.nextLine());
				if (selectNum == -1) {
					return -1;
				} else if (selectNum >= 1 && selectNum <= sellMenu.length) {
					return (selectNum - 1);
				} else {
					System.out.println("메뉴 버튼의 숫자만 입력해주세요.");
					continue;
				}
			} catch (Exception e) {
				System.out.println("메뉴 버튼의 숫자만 입력해주세요.");
			}
		}
	}
	
	
	public int buyItem(int selectNum) {
		if (menu[sellMenu[selectNum]].stock < 1) {
			System.out.println("재고가 부족합니다.");
		}else if(inven[inven.length-1]!=null){
			System.out.println("인벤토리에 공간이 없습니다.");
			return 0;
		}else if((UserStats.money-menu[sellMenu[selectNum]].price)<0){
			System.out.println("물건을 구매할 돈이 없습니다.");
			return UserStats.money;
		}else {
			sales = sales + menu[sellMenu[selectNum]].price;
			menu[sellMenu[selectNum]].stock--;
			UserStats.money-=menu[sellMenu[selectNum]].price;
			for(int i=0;i<inven.length;i++) {
				if(inven[i]==null) {
					inven[i]=menu[sellMenu[selectNum]];
					break;
				}
			}
			System.out.println(menu[sellMenu[selectNum]].name + "을(를) 구매하셨습니다.\n남은 금액은 "+UserStats.money+"입니다.");
		}
		return UserStats.money;
	}


	//------------------------------------------------------------------------------------------------

	public void showInventory() {
		for (int i = 0; i < inven.length; i++) {
			try {
				if(inven[i].stock!=0)
					System.out.println((i+1) + ". " + inven[i].name + " : " + inven[i].price);
			} catch (Exception e) {}
		}
	}
	
	// 3.팔고 싶은 메뉴를 선택하는 메소드.	
	
	public int sellSelect() {
		while (true) {
			showInventory();
			System.out.print("팔고 싶은 장비 번호를 입력해주세요.\n(-1 입력 시 종료)\n=>");
			try {
				selectNum = Integer.parseInt(sc.nextLine());
				if (selectNum == -1) {
					return -1;
				} else if (selectNum >= 1 && selectNum <=inven.length) {
					return (selectNum - 1);
				} else {
					System.out.println("메뉴 버튼의 숫자만 입력해주세요.");
					continue;
				}
			} catch (Exception e) {
				System.out.println("메뉴 버튼의 숫자만 입력해주세요.");
			}
		}
	}
	

	
	public int sellItem(int number) {
		if (number>=inven.length||number<0){
			System.out.println("\n옳지 않은 선택지입니다.");
		}else if(inven[number]==null) {
			System.out.println("\n해당 공간에는 장비가 없습니다.");
		}else {
			UserStats.money+=(inven[number].price)/10;
			inven[number]=null;
			System.out.println(menu[number].name + "이(가) 판매되었습니다.\n판매 금액 : "+(inven[number].price/10)+"을 획득했습니다.");
			return UserStats.money;
		}
		return 0;
	}
	
	public void shop(){
		//상점 이거 요약 어케 Store에 보냄;;
		mixMenu();
		while(true) {
			try {
				showMenu();
				System.out.print("\n(1.구매 / 2.정보 / 3.판매 / 4.나가기)\n=>");
				int select = Integer.parseInt(sc.nextLine());
				if(select==1) {
					while(true) {
						select = buySelect();
						if (select == -1) {	
							break;
						} else {	
							UserStats.money=buyItem(select);
						}
					}
				}else if(select==2) {
					System.out.println(menuInfo());
				}else if(select==3) {
					while(true) {
						select = sellSelect();
						if (select == -1) {	
							break;
						} else {	
							UserStats.money=sellItem(select);
						}
					}
				}else if(select==4) {
					System.out.println("상점을 떠납니다.");
					System.out.println("----------------------------------------");
					break;
				}
			} catch (Exception e) {
				System.out.println("메뉴 버튼의 숫자만 입력해주세요.");}	
		}//상점 이거 끝내긴 했음
	}
}